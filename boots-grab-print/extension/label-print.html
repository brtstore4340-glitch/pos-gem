<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏û‡∏¥‡∏°‡∏û‡πå‡∏â‡∏•‡∏≤‡∏Å - Grab Print</title>
  <style>
    @page { size: 80mm auto; margin: 8mm 3mm; }
    
    body {
      font-family: system-ui, -apple-system, 'TH Sarabun New', sans-serif;
      margin: 0;
      padding: 0;
      width: 80mm;
      position: relative;
    }
    
    /* Preview styles (hidden when printing) */
    .preview-header {
      background: #fff;
      padding: 16px 20px;
      border-bottom: 2px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .preview-header h2 { margin: 0; font-size: 18px; color: #111827; }
    
    .preview-actions { display: flex; gap: 12px; }
    
    .btn-primary {
      background: #111827; color: white; border: none;
      padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer;
    }
    
    .btn-secondary {
      background: #e5e7eb; color: #111827; border: none;
      padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer;
    }
    
    .print-status {
      position: fixed; bottom: 20px; right: 20px;
      padding: 12px 20px; border-radius: 8px; font-weight: 600; display: none;
    }
    .print-status.success { display: block; background: #10b981; color: white; }
    .print-status.error { display: block; background: #ef4444; color: white; }
    
    /* Label styles */
    .stub {
      padding: 2mm 3mm 3mm;
      border-bottom: 1px dashed #000;
      position: relative;
    }
    
    .stub--flip {
      transform: rotate(180deg);
      border-bottom: 0;
      padding-top: 3mm;
      padding-bottom: 2mm;
    }
    
    .hdr {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 2px;
    }
    
    .gm {
      font-size: 18pt;
      font-weight: 900;
      line-height: 1;
    }
    
    .muted {
      opacity: 0.8;
      font-size: 11px;
    }
    
    .qr {
      width: 100px;
      height: 100px;
    }
    
    .row {
      display: flex;
      gap: 6px;
      align-items: flex-start;
      margin: 2px 0;
    }
    
    .qty {
      width: 12%;
      text-align: center;
      font-weight: 800;
    }
    
    .info {
      width: 63%;
    }
    
    .price {
      width: 25%;
      text-align: right;
      font-weight: 800;
    }
    
    .item-name { font-size: 12px; font-weight: 600; }
    .item-code { font-size: 10px; color: #666; }
    .discount { font-size: 10px; color: #c00; }
    .total {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      margin-top: 4px;
      padding-top: 2mm;
      border-top: 1px dashed #000;
    }
    
    .total .amt {
      font-size: 20pt;
      font-weight: 900;
    }
    
    .driver-info {
      font-size: 11px;
      margin-top: 2mm;
      padding-top: 2mm;
      border-top: 1px dotted #ccc;
    }
    
    @media print {
      .preview-header { display: none !important; }
      .print-status { display: none !important; }
      @page { size: 80mm auto; margin: 0; }
    }
  </style>
</head>
<body>
  <!-- Preview Header -->
  <div class="preview-header" id="previewHeader">
    <h2>üè∑Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏â‡∏•‡∏≤‡∏Å (Dual Stub)</h2>
    <div class="preview-actions">
      <button id="btnPrint" class="btn-primary">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå</button>
      <button id="btnClose" class="btn-secondary">‡∏õ‡∏¥‡∏î</button>
    </div>
  </div>

  <!-- Upper Stub (Normal) -->
  <div class="stub" id="upperStub">
    <div class="hdr">
      <div>
        <div class="gm">GM</div>
        <div class="muted" id="bookingCode">Booking: -</div>
      </div>
      <img class="qr" id="qrCode" src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100'><rect fill='white' width='100%' height='100%'/><text x='50%25' y='50%25' text-anchor='middle' dy='.3em' font-size='12' fill='black'>QR</text></svg>" alt="QR">
    </div>
    <div class="driver-info" id="driverInfo">
      Driver: -<br>Phone: -
    </div>
  </div>

  <!-- Lower Stub (Flipped) -->
  <div class="stub stub--flip" id="lowerStub">
    <div class="hdr">
      <img class="qr" id="qrCode2" src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100'><rect fill='white' width='100%' height='100%'/><text x='50%25' y='50%25' text-anchor='middle' dy='.3em' font-size='12' fill='black'>QR</text></svg>" alt="QR">
      <div style="text-align: right;">
        <div class="gm">GM</div>
        <div class="muted" id="bookingCode2">Booking: -</div>
      </div>
    </div>
    <div class="driver-info" id="driverInfo2" style="text-align: right;">
      Driver: -<br>Phone: -
    </div>
  </div>

  <!-- Print Status -->
  <div class="print-status" id="printStatus"></div>

  <script src="src/label-print.js"></script>
</body>
</html>
